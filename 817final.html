<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <title>Cities</title>
    <link rel="stylesheet"href="https://js.arcgis.com/4.22/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.22/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #timeSlider {
        position: absolute;
        left: 5%;
        right: 5%;
        bottom: 20px;
      }

    </style>
    <script>

      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/TimeSlider",
        "esri/widgets/Legend"
      ], function (Map, MapView, FeatureLayer, TimeSlider, Legend) {

        const popupTemplatestates = {
                  // autocasts as new PopupTemplate()
                  title: "On {Date}, {State} was admitted as the {ADMIT} state admitted to the United States",
                  content: [
                    {
                      type: "fields",
                      fieldInfos: [
                        {
                          fieldName: "Date",
                          label: "Date",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "State",
                          label: "State",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "ADMIT",
                          label: "Admitted",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
]}]};
        const popupTemplatetransportation = {
                  // autocasts as new PopupTemplate()
                  title: "On {Date}, {State} was admitted as the {ADMIT} state admitted to the United States",
                  content: [
                    {
                      type: "fields",
                      fieldInfos: [
                        {
                          fieldName: "YearBegin",
                          label: "Date",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "FULLNAME",
                          label: "Type",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },

]}]};        const popupTemplatepopulation = {
                  // autocasts as new PopupTemplate()
                  title: "In {DECADE}, {CITY} had a population of {POP}, and was ranked {RANK}, with a population change of {POPCHANGE} percent",
                  content: [
                    {
                      type: "fields",
                      fieldInfos: [
                        {
                          fieldName: "DECADE",
                          label: "Decade",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "CITY",
                          label: "City",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "POP",
                          label: "Population",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                          fieldName: "RANK",
                          label: "Rank",
                          format: {
                            places: 0,
                            digitSeparator: true
                          }
                        },
                        {
                        fieldName: "POPCHANGE",
                        label: "Population Change",
                        format: {
                          places: 0,
                          digitSeparator: true
}

                        }]}]};


const stateslayer = new FeatureLayer({
url:   "https://services8.arcgis.com/jzdN07B7ZhRTxuzU/arcgis/rest/services/United_States/FeatureServer",
outFields: ["Date", "State", "Admit", "YearBegin"], // used to specify what attribute fields to query
popupTemplate: popupTemplatestates
        });
const transportationlayer = new FeatureLayer({
url:   "https://services8.arcgis.com/jzdN07B7ZhRTxuzU/arcgis/rest/services/transportation/FeatureServer",
outFields: ["Date", "State", "Admit", "YearBegin"], // used to specify what attribute fields to query
        popupTemplate: popupTemplatetransportation
        });
const poplayer = new FeatureLayer({
url:   "https://services8.arcgis.com/jzdN07B7ZhRTxuzU/arcgis/rest/services/Population_Rank/FeatureServer",
outFields: ["DECADE", "CITY", "POP", "RANK", "POPCHANGE", "YearBegin"], // used to specify what attribute fields to query
       popupTemplate: popupTemplatepopulation
      });

              const map = new Map({
                      basemap: "oceans",
                      layers: [stateslayer, transportationlayer, poplayer] //if you add more layers, separate by a comma
                    });

                    const view = new MapView({
                            map: map,
                            container: "viewDiv",
                            zoom: 5, //zoomed almost all the way out to see the globe
                            center: [-98.5795, 39.8283] //set this somewhere in the middle of the Pacific
                          });

                          const timeSlider = new TimeSlider({
                              container: "timeSlider",
                              view: view,
                              timeVisible: true, // show the time stamps on the timeslider
                              loop: true
                             });

                          view.whenLayerView(stateslayer, transportationlayer, poplayer).then(function (lv) {
                                  // this just rounds up the time extent to full hours
                           timeSlider.fullTimeExtent = layer.timeInfo.fullTimeExtent.expandTo("YearBegin");
                                });


                          const legend = new Legend({
                                  view: view
                                });

                          view.ui.add(legend, "top-left"); //you can position the legend here

                          });
                           </script>
                            </head>

                            <body>
                              <div id="viewDiv"></div>
                              <div id="timeSlider"></div>
                            </body>

                          </html>
